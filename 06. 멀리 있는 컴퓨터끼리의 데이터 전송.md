
# 06 IP 프로토콜

 



## IPv4 프로토콜

### IPv4가 하는 일

- 네트워크 상에서 데이터를 교환하기 위한 프로토콜
- 데이터가 정확하게 전달될 것을 보장하지 않는다
  - 데이터가 중간에 누락되거나, 잘못되어서 깨질 수 있다
  - 이는, 다른 계층(4계층 등)에서 보완해줄 수 있다
- 데이터의 정확하고 순차적인 전달은 다른 계층에서 함
- 중복된 패킷을 전달하거나 패킷의 순서를 잘못 전달할 가능성도 있다.
  - (악의적으로 이용되면 DoS 공격이 됨)
- 데이터의 정확하고 순차적인 전달은 그보다 상위 프로토콜인 TCP에서 보장한다.



### IPv4 프로토콜의 구조
![image](https://user-images.githubusercontent.com/69442847/197900587-f9f105a3-a09f-45c5-9927-158eb50ca83b.png)

- 최소 20 Byte (4byte씩 5줄) + (옵션붙으면 하나당 4byte, 최대 10개 붙을 수 있음)
- Flags : 내 뒤에 패킷이 더 있는지
- Fragment Offset : offset을 그냥 쓰지 않고 8로 나눠서 씀
- 패킷의 오프셋으로 순서를 맞추게 됨!



## ICMP 프로토콜

### ICMP가 하는 일

- **Internet Control Message Protocol, 인터넷 제어 메세지 프로토콜**
- 네트워크 컴퓨터 위에서 돌아가는 OS에서 오류 메시지를 전송받는데 주로 쓰인다
- 프로토콜 구조의 Type과 Code를 통해 오류 메시지를 전송받는다. 상대방과 통신이 되는지 안 되는지 확인하기 위한 용도로 많이 쓰인다.



### ICMP 프로토콜의 구조

![img](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/ICMP_header_-_General-en.svg/300px-ICMP_header_-_General-en.svg.png)

![img](https://image.slidesharecdn.com/internetcontrolmessageprotocol-121115085749-phpapp01/95/internet-control-message-protocol-13-638.jpg?cb=1352969905)

- 타입 0,8 코드 3,11 은 알아두는게 좋다
- Type: 카테고리 중 대분류, 0, 3, 8, 10, 11 ... 등 Message Type 들이 있다. 
  - 8번은 요청, 0번은 응답, 
  - 3번은 Destination Unreachable(가는 경로 상 문제), 
  - 11번은 Time exceed(상대방 쪽 문제, 방화벽 등). 해당 코드로 네트워크가 안될 때 message를 통해 왜 안되는지에 대한 이유를 알 수 있다. 
  - 5번은 ICMP redirect(원격지에 있는 상대방의 라우팅 테이블을 ICMP를 통해 수정할 때 사용->보안 문제 )
- Code: 카테고리 중 소분류
- Checksum: 해당 헤더에 오류가 있는지 확인할 수 있는 값. 패킷의 리시버가 헤더의 속성값들을 더하여 Checksum과 비교. 만약 같다면 오류 없이 전달 받은 것.

## 라우팅 테이블
### 내가 보낸 패킷은 어디로 가는가
```netstat -r```
어디로 보내야 하는지 설정되어 있는 라우팅 테이블
지도 같은 개념으로 라우팅 테이블에 적혀있는 부분만 찾아갈 수 있고, 적혀있지 않은 부분은 찾아갈 수 없음
보통 라우팅 테이블을 작성할 때 기본 값을 넣어줌.(기본 게이트웨이 ..)

## 다른 네트워크와 통신 과정
### 다른 네트워크까지 내 패킷의 이동 과정
보낼 라우팅 테이블에 해당 패킷을 받을 네트워크 대역이 있어야 전송이 가능

## IPv4의 조각화

### 조각화란?

- 큰 IP 패킷들이 적은 MTU(Maximum Transmission Unit)를 갖는 링크를 통해 전송되려면 여러 개의 작은 패킷으로 쪼개서/조각화돼서 전송돼야한다.
- 큰 데이터를 여러 개의 패킷으로 조각화
- 만약 MTU 가 980이면 IPv4 20바이트 빼고 960Byte의 데이터만 보낼수있다는 뜻


[출처 블로그](https://velog.io/@ppmyor/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-06.-%EB%A9%80%EB%A6%AC-%EC%9E%88%EB%8A%94-%EC%BB%B4%ED%93%A8%ED%84%B0%EB%81%BC%EB%A6%AC%EB%8A%94-%EC%9D%B4%EB%A0%87%EA%B2%8C-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%A3%BC%EA%B3%A0%EB%B0%9B%EB%8A%94%EB%8B%A4)
